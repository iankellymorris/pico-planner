<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assignment Tracker</title>
  <!-- Tabulator Modern CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/css/tabulator_modern.min.css" rel="stylesheet">
  <!-- Google Fonts: DM Sans & Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@1,600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 20px;
      background: #ede3fa; /* warmer lavender */
    }
    h1 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-style: italic;
      text-align: left;
      font-size: 3.75rem; /* bigger */
      margin-bottom: 20px;
      color: #4b2e83;
      letter-spacing: -0.5px;
      line-height: 1.2;
      padding-left: 15px;
    }
    .form-container {
      margin: 20px 0;
      padding: 18px;
      background: rgba(75, 46, 131, 0.18);
      border: 1px solid rgba(75, 46, 131, 0.25);
      border-radius: 20px; /* more rounded */
    }
    .form-container input, .form-container select, .form-container button {
      margin-right: 10px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    /* Table font styles */
    .tabulator, .tabulator .tabulator-header, .tabulator .tabulator-cell {
      font-family: 'Poppins', sans-serif !important;
    }
    .tabulator .tabulator-header .tabulator-col .tabulator-col-title {
      font-weight: 600;
    }
    .delete-btn {
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      font-family: "Courier New", monospace;
      line-height: 1;
      color: rgba(0,0,0,0.3); /* lighter overlay */
    }
    .delete-btn:hover {
      color: rgba(0,0,0,0.55); /* slightly darker on hover */
    }

    /* Kill Tabulatorâ€™s built-in row striping */
    .tabulator-row:nth-child(even),
    .tabulator-row:nth-child(odd) {
      background: unset !important;
    }

    /* PHYS 2210 rows */
    .row-phys { background: #dbe7f8 !important; }       /* soft blue */
    .row-phys:nth-child(even) { background: #edf4fc !important; }

    /* ECE 1400 rows */
    .row-ece { background: #f8dbdb !important; }        /* soft red */
    .row-ece:nth-child(even) { background: #fceeee !important; }

    /* MATH 1210 rows */
    .row-math { background: #faf3d1 !important; }       /* soft yellow */
    .row-math:nth-child(even) { background: #fef9e4 !important; }
  </style>
</head>
<body>
  <h1>Assignment Tracker</h1>

  <!-- Form for adding assignments -->
  <div class="form-container">
    <select id="class-input">
      <option value="MATH 1210">MATH 1210</option>
      <option value="PHYS 2210">PHYS 2210</option>
      <option value="ECE 1400">ECE 1400</option>
    </select>
    <input type="text" id="assignment-input" placeholder="Assignment Name">
    <input type="date" id="due-input">
    <input type="url" id="link-input" placeholder="https://...">
    <button id="add-btn">Add Assignment</button>
  </div>

  <div id="assignment-table"></div>

  <!-- Tabulator JS -->
  <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <script>
    // Load saved data or use defaults
    let savedData = JSON.parse(localStorage.getItem("assignments")) || [
      { class: "MATH 1210", assignment: "HW 1", due: "2025-09-01", link: "" },
      { class: "PHYS 2210", assignment: "Lab 1", due: "2025-09-03", link: "" },
      { class: "ECE 1400", assignment: "Project Proposal", due: "2025-09-05", link: "" }
    ];

    // Safe ISO date parser
    function parseISODateSafe(str){
      if(!str) return null;
      const d = new Date(str);
      return isNaN(d.getTime()) ? null : d;
    }

    // Custom date formatter
    function dueDateFormatter(cell){
      const value = cell.getValue();
      const d = parseISODateSafe(value);
      if(!d) return "---";
      const day = String(d.getDate()).padStart(2, "0");
      const month = d.toLocaleString("en-US", { month: "short" }).toUpperCase();
      const year = d.getFullYear();
      return `${day} ${month} ${year}`;
    }

    // Custom delete formatter
    function deleteFormatter(cell, formatterParams, onRendered) {
      return "<span class='delete-btn'>&times;</span>";
    }

    // Initialize table
    const table = new Tabulator("#assignment-table", {
      data: savedData,
      layout: "fitColumns",
      reactiveData: true,
      groupBy: "class",
      groupStartOpen: true,
      columns: [
        { title: "Class", field: "class", editor: "select", editorParams: {
            values: ["MATH 1210", "PHYS 2210", "ECE 1400"]
          }},
        { title: "Assignment", field: "assignment", editor: "input",
          formatter: function(cell){
            const link = cell.getRow().getData().link;
            const assignment = cell.getValue();
            return link ? `<a href="${link}" target="_blank">${assignment}</a>` : assignment;
          }},
        { 
          title: "Due Date", 
          field: "due", 
          editor: "date", 
          sorter: function(a, b){
            const da = parseISODateSafe(a);
            const db = parseISODateSafe(b);
            if(!da && !db) return 0;
            if(!da) return -1;
            if(!db) return 1;
            return da - db;
          },
          formatter: dueDateFormatter
        },
        { title: "Link", field: "link", visible: false },
        { 
          title: "", 
          formatter: deleteFormatter, 
          width: 40, 
          hozAlign: "center", 
          cellClick: function(e, cell){
            cell.getRow().delete();
            saveData();
          }
        }
      ],
      rowFormatter: function(row){
        const data = row.getData();
        const el = row.getElement();
        el.classList.remove("row-phys","row-ece","row-math");
        if (data.class === "PHYS 2210") el.classList.add("row-phys");
        if (data.class === "ECE 1400") el.classList.add("row-ece");
        if (data.class === "MATH 1210") el.classList.add("row-math");
      },
      cellEdited: saveData,
      rowDeleted: saveData,
    });

    // Save data to localStorage
    function saveData() {
      localStorage.setItem("assignments", JSON.stringify(table.getData()));
    }

    // Add new assignment from form
    document.getElementById("add-btn").addEventListener("click", () => {
      const newRow = {
        class: document.getElementById("class-input").value,
        assignment: document.getElementById("assignment-input").value,
        due: document.getElementById("due-input").value,
        link: document.getElementById("link-input").value
      };
      table.addRow(newRow);
      saveData();

      // Clear inputs
      document.getElementById("assignment-input").value = "";
      document.getElementById("due-input").value = "";
      document.getElementById("link-input").value = "";
    });
  </script>
</body>
</html>

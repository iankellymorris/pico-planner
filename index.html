<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assignment Tracker</title>
  <!-- Tabulator Modern CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/css/tabulator_modern.min.css" rel="stylesheet">
  <!-- Google Fonts: DM Sans & Inter -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@1,600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <!-- localForage (IndexedDB wrapper) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 20px;
      background: #ede3fa; /* warmer lavender */
    }
    h1 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-style: italic;
      text-align: left;
      font-size: 3.75rem; /* 25% bigger */
      margin-bottom: 20px;
      color: #4b2e83;
      letter-spacing: -0.5px;
      line-height: 1.2;
      padding-left: 12px; /* subtle offset */
    }
    .form-container {
      margin: 20px 0;
      padding: 15px;
      background: rgba(75, 46, 131, 0.18);
      border: 1px solid rgba(75, 46, 131, 0.25);
      border-radius: 22px; /* more rounding */
    }
    .form-container input, .form-container select, .form-container button {
      margin-right: 10px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #error-message {
      margin-top: 10px;
      color: #c0392b;
      font-size: 0.9rem;
      font-weight: 600;
    }
    /* Table font styles */
    .tabulator, .tabulator .tabulator-header, .tabulator .tabulator-cell {
      font-family: 'Inter', sans-serif !important;
    }
    .tabulator .tabulator-header .tabulator-col .tabulator-col-title {
      font-weight: 600;
    }
    .tabulator .tabulator-header .tabulator-col {
      padding-top: 12px;
      padding-bottom: 12px;
    }
    .delete-btn {
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      font-family: "Courier New", monospace;
      line-height: 1;
      color: rgba(0,0,0,0.3);
    }
    .delete-btn:hover {
      color: rgba(0,0,0,0.55);
    }
  </style>
</head>
<body>
  <h1>Assignment Tracker</h1>

  <!-- Form for adding assignments -->
  <div class="form-container">
    <select id="class-input">
      <option value="MATH 1220">MATH 1220</option>
      <option value="PHYS 2210">PHYS 2210</option>
      <option value="ECE 1400">ECE 1400</option>
    </select>
    <input type="text" id="assignment-input" placeholder="Assignment Name">
    <input type="date" id="due-input">
    <input type="url" id="link-input" placeholder="https://...">
    <button id="add-btn" disabled>Add Assignment</button>
    <div id="error-message"></div>
  </div>

  <div id="assignment-table"></div>

  <!-- Tabulator JS -->
  <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <script>
    // configure localForage
    localforage.config({
      name: "AssignmentTracker",
      storeName: "assignments"
    });

    let table;

    // Show error messages
    function showError(msg) {
      const errorDiv = document.getElementById("error-message");
      errorDiv.textContent = msg;
      setTimeout(() => { errorDiv.textContent = ""; }, 5000); // clear after 5s
    }

    // Load saved data or defaults
    async function loadData() {
      try {
        let savedData = await localforage.getItem("assignments");
        if (!savedData) {
          savedData = [
            { class: "MATH 1220", assignment: "HW 1", due: "2025-09-01", link: "" },
            { class: "PHYS 2210", assignment: "Lab 1", due: "2025-09-03", link: "" },
            { class: "ECE 1400", assignment: "Project Proposal", due: "2025-09-05", link: "" }
          ];
          await localforage.setItem("assignments", savedData);
        }
        initTable(savedData);
      } catch (err) {
        showError("Failed to load assignments.");
        console.error(err);
      }
    }

    // Save data to IndexedDB
    async function saveData() {
      try {
        await localforage.setItem("assignments", table.getData());
      } catch (err) {
        showError("Failed to save assignments.");
        console.error(err);
      }
    }

    // Custom delete formatter (× instead of ❌)
    function deleteFormatter(cell) {
      return "<span class='delete-btn'>&times;</span>";
    }

    // Initialize table
    function initTable(data) {
      table = new Tabulator("#assignment-table", {
        data: data,
        layout: "fitColumns",
        reactiveData: true,
        groupBy: "class",
        groupStartOpen: true,
        columns: [
          { title: "Class", field: "class", editor: "select", editorParams: {
              values: ["MATH 1220", "PHYS 2210", "ECE 1400"]
            }},
          { title: "Assignment", field: "assignment", editor: "input" },
          { 
            title: "Due Date", 
            field: "due", 
            editor: "date", 
            sorter: "date", 
            formatter: "datetime",
            formatterParams: {
              outputFormat: "dd MMM yyyy", // DD MON YYYY
              invalidPlaceholder: "---"
            }
          },
          { title: "Link", field: "link", editor: "input",
            formatter: "link", formatterParams: { target: "_blank" } },
          { 
            title: "", 
            formatter: deleteFormatter, 
            width: 40, 
            hozAlign: "center", 
            cellClick: function(e, cell){
              cell.getRow().delete();
              saveData();
            }
          }
        ],
        cellEdited: saveData,
        rowDeleted: saveData,
      });

      // Enable the add button AFTER table is ready
      document.getElementById("add-btn").disabled = false;
    }

    // Add new assignment from form
    document.getElementById("add-btn").addEventListener("click", async () => {
      try {
        if (!table) {
          showError("Table not ready yet.");
          return;
        }
        const newRow = {
          class: document.getElementById("class-input").value,
          assignment: document.getElementById("assignment-input").value,
          due: document.getElementById("due-input").value,
          link: document.getElementById("link-input").value
        };
        await table.addData([newRow], true); // more reliable than addRow
        await saveData();

        // Clear inputs
        document.getElementById("assignment-input").value = "";
        document.getElementById("due-input").value = "";
        document.getElementById("link-input").value = "";
      } catch (err) {
        showError("Failed to add assignment.");
        console.error(err);
      }
    });

    // load everything
    loadData();
  </script>
</body>
</html>

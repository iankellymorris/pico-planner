<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assignment Tracker (Terrence V12)</title>

  <!-- Tabulator Modern CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/css/tabulator_modern.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@900&family=Lato:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --entryTableDelta: 20px;         /* vertical spacing between form and table */
      --titleLeftEdgePadding: 20px;    /* title padding-left */
      --tableRightEdgePadding: 16px;   /* right margin for table */
      --tableLeftEdgePadding: 280px;   /* left margin for table */
      --dropdownWidth: 180px;          /* width for course dropdown */
      --formScale: 0.85;               /* scale factor for assignment entry */

      /* new variables */
      --titleFontSize: 3.2rem;         /* title font size */
      --titleColor: #4b2e83;           /* title font color */
      --backgroundColor: #ede3fa;      /* page background */
      --pageTopPadding: 10px;          /* top padding for the page */
    }

    body {
      font-family: 'Lato', sans-serif;
      margin: 0;
      padding-top: var(--pageTopPadding);
      padding-left: 20px;
      padding-right: 20px;
      background: var(--backgroundColor);
    }

    h1 {
      font-family: 'Raleway', sans-serif;
      font-weight: 900; /* Black weight */
      text-align: left;
      font-size: var(--titleFontSize);
      margin-bottom: 16px;
      color: var(--titleColor);
      padding-left: var(--titleLeftEdgePadding);
    }

    /* wrapper for centering */
    .form-wrap {
      text-align: center;
    }

    .form-container {
      display: inline-block;
      margin: 20px auto var(--entryTableDelta) auto;
      padding: 20px 22px;
      background: rgba(75, 46, 131, 0.16);
      border: 1px solid rgba(75, 46, 131, 0.22);
      border-radius: 40px;
      transform: scale(var(--formScale));
      transform-origin: center;
    }

    .form-container input,
    .form-container button {
      margin-right: 10px;
      padding: 10px 16px;
      border-radius: 9999px; /* pill style */
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    /* custom pill dropdown fix */
    .select-wrapper {
      position: relative;
      display: inline-block;
      width: var(--dropdownWidth);
      margin-right: 10px;
    }

    .select-wrapper select {
      width: 100%;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      border-radius: 9999px;
      padding: 10px 36px 10px 16px; /* extra right padding for arrow */
      border: 1px solid #ccc;
      font-size: 1rem;
      background: #fff;
    }

    .select-wrapper::after {
      content: "â–¼";
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.75rem;
      color: #555;
      pointer-events: none;
    }

    /* Table font */
    .tabulator,
    .tabulator .tabulator-header,
    .tabulator .tabulator-cell {
      font-family: 'Lato', sans-serif !important;
    }

    .tabulator {
      margin-left: var(--tableLeftEdgePadding);
      margin-right: var(--tableRightEdgePadding);
    }

    .tabulator .tabulator-cell {
      padding-left: 15px !important;
    }

    .tabulator .tabulator-header .tabulator-col .tabulator-col-title {
      font-weight: 700;
      padding-top: 6px;
      padding-bottom: 6px;
    }

    /* Remove periwinkle backgrounds */
    .tabulator,
    .tabulator .tabulator-tableholder,
    .tabulator-row {
      background: none !important;
    }

    /* Make table expand instead of scroll */
    .tabulator .tabulator-tableholder {
      overflow-y: visible !important;
    }

    /* Remove arrows/bars */
    .tabulator .tabulator-group .tabulator-arrow {
      display: none !important;
    }
    .tabulator .tabulator-group-header {
      padding-left: 0 !important;
    }

    /* delete button centering */
    .delete-btn {
      cursor: pointer;
      font-size: 1.15rem;
      font-family: "Courier New", monospace;
      color: rgba(0,0,0,0.32);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }
    .delete-btn:hover { color: rgba(0,0,0,0.6); }

    /* export/import buttons */
    .data-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 15px;
      margin-right: var(--tableRightEdgePadding);
    }

    .data-buttons button {
      margin-left: 10px;
      padding: 8px 14px;
      border-radius: 9999px;
      border: 1px solid #bbb;
      background: #f9f9f9;
      color: #aaa;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .data-buttons button:hover {
      background: #eaeaea;
    }
  </style>
</head>
<body>
  <h1>Assignment&nbsp;&nbsp;Tracker</h1>

  <div class="form-wrap">
    <div class="form-container">
      <div class="select-wrapper">
        <select id="class-input">
          <option value="MATH 1210">MATH 1210</option>
          <option value="PHYS 2210">PHYS 2210</option>
          <option value="ECE 1400">ECE 1400</option>
        </select>
      </div>

      <input type="text" id="assignment-input" placeholder="Assignment Name">
      <input type="date" id="due-input">
      <input type="url" id="link-input" placeholder="https://...">
      <button id="add-btn">Add Assignment</button>
    </div>
  </div>

  <div id="assignment-table"></div>

  <!-- export/import buttons -->
  <div class="data-buttons">
    <button id="export-btn">Export Data</button>
    <button id="import-btn">Import Data</button>
    <input type="file" id="import-file" accept=".json" style="display:none;">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tabulator-tables@5.5.2/dist/js/tabulator.min.js"></script>
  <script>
    function escapeHtml(str){
      if (str == null) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    const COLORS = {
      PHYS: { even: "#dbe7f8", odd: "#edf4fc", header: "#5b78b0" },
      ECE:  { even: "#f8dbdb", odd: "#fceeee", header: "#b04b4b" }, // redder red
      MATH: { even: "#faf3d1", odd: "#fef9e4", header: "#c4b000" }  // yellower yellow
    };

    function parseISODateSafe(str){
      if (!str) return null;
      const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(str);
      if (!m) return null;
      return new Date(+m[1], +m[2]-1, +m[3]);
    }

    function formatDueDateISOToDDMONYYYY(iso){
      const d = parseISODateSafe(iso);
      if (!d) return "";
      const months = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];
      return String(d.getDate()).padStart(2,"0")+" "+months[d.getMonth()]+" "+d.getFullYear();
    }

    let savedData = JSON.parse(localStorage.getItem("assignments")) || [
      { class: "MATH 1210", assignment: "HW 1", due: "2025-09-01", link: "" },
      { class: "PHYS 2210", assignment: "Lab 1", due: "2025-09-03", link: "" },
      { class: "ECE 1400", assignment: "Project Proposal", due: "2025-09-05", link: "" }
    ];

    function applyRowBackground(row){
      const cls = row.getData().class;
      const rows = table.getRows().filter(r => r.getData().class === cls);
      const idx = rows.indexOf(row);
      const even = idx % 2 === 0;
      let bg = "";
      if (cls === "PHYS 2210") bg = even ? COLORS.PHYS.even : COLORS.PHYS.odd;
      if (cls === "ECE 1400") bg = even ? COLORS.ECE.even : COLORS.ECE.odd;
      if (cls === "MATH 1210") bg = even ? COLORS.MATH.even : COLORS.MATH.odd;
      row.getElement().querySelectorAll(".tabulator-cell").forEach(c => c.style.background = bg);
    }

    function assignmentFormatter(cell){
      const data = cell.getRow().getData();
      return data.link ? `<a href="${escapeHtml(data.link)}" target="_blank">${escapeHtml(cell.getValue())}</a>` : escapeHtml(cell.getValue());
    }

    function dueFormatter(cell){
      return formatDueDateISOToDDMONYYYY(cell.getValue());
    }

    function deleteFormatter(){
      return "<span class='delete-btn'>&times;</span>";
    }

    const table = new Tabulator("#assignment-table", {
      data: savedData,
      layout: "fitColumns",
      reactiveData: true,
      groupBy: "class",
      groupStartOpen: true,
      groupHeader: function(value){
        let bg = "#ddd", fg = "#fff";
        if (value === "PHYS 2210"){ bg = COLORS.PHYS.header; fg = "#fff"; }
        if (value === "ECE 1400"){ bg = COLORS.ECE.header; fg = "#fff"; }
        if (value === "MATH 1210"){ bg = COLORS.MATH.header; fg = "#fff"; }
        return `<div style="background:${bg};color:${fg};padding:6px 10px;border-radius:6px;font-weight:bold;">${value}</div>`;
      },
      columns: [
        { title: "Class", field: "class", visible: false },
        { title: "Assignment", field: "assignment", editor: "input", formatter: assignmentFormatter },
        { title: "Due Date", field: "due", sorter:(a,b)=>parseISODateSafe(a)-parseISODateSafe(b), editor: "date", formatter: dueFormatter },
        { title: "Link", field: "link", visible: false },
        { 
          title: "", 
          field: "delete", 
          width: 40, 
          hozAlign: "center", 
          headerSort: false, /* disable sort arrow */
          formatter: deleteFormatter, 
          cellClick:(e,cell)=>{ 
            cell.getRow().delete(); 
            saveData(); 
          } 
        }
      ],
      rowFormatter: applyRowBackground,
      renderComplete: function(){ this.getRows().forEach(applyRowBackground); },
      cellEdited: function(cell){ saveData(); applyRowBackground(cell.getRow()); }
    });

    function saveData(){ 
      localStorage.setItem("assignments", JSON.stringify(table.getData())); 
    }

    document.getElementById("add-btn").addEventListener("click", () => {
      const newRow = {
        class: document.getElementById("class-input").value,
        assignment: document.getElementById("assignment-input").value,
        due: document.getElementById("due-input").value,
        link: document.getElementById("link-input").value
      };
      table.addRow(newRow).then(row => { 
        saveData(); 
        applyRowBackground(row); 
      });
      document.getElementById("assignment-input").value = "";
      document.getElementById("due-input").value = "";
      document.getElementById("link-input").value = "";
    });

    // Export Data
    document.getElementById("export-btn").addEventListener("click", () => {
      const dataStr = JSON.stringify(table.getData(), null, 2);
      const blob = new Blob([dataStr], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "assignments.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Import Data
    document.getElementById("import-btn").addEventListener("click", () => {
      document.getElementById("import-file").click();
    });

    document.getElementById("import-file").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const imported = JSON.parse(ev.target.result);
          table.replaceData(imported);
          saveData();
        } catch {
          alert("Invalid file format. Please select a valid JSON export.");
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
